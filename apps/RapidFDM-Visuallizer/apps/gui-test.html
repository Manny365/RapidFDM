<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GUI-Test-Background</title>
    <script src="../static/js/three.js"></script>
    <script src="../static/js/ImprovedNoise.js"></script>
    <script src="../static/js/CanvasRenderer.js"></script>
    <script src="../static/js/Projector.js"></script>
    <script src='../static/js/stats.min.js'></script>
    <script src="../static/js/OrbitControls.js"></script>
    <script src="../static/js/TextGeometry.js"></script>
    <script src="../static/js/FontUtils.js"></script>
    <script src="../static/js/helvetiker_regular.typeface.js"></script>
    <script src="../static/js/jquery-1.11.3.min.js"></script>
    <script src="js/DroneDisplayCameraController.js"></script>
    <script src="js/DroneDisplayEngine.js"></script>
    <script src="js/AirfoilLoader.js"></script>
    <script src="js/configurer_driver.js"></script>
    <script src="js/components_geometry_loader.js"></script>
    <link rel="stylesheet" type="text/css" href="css/editor-ui.css">
</head>
<body>
<div id="container">
</div>
<div id="logs">
    <textarea id="log_plant" readonly="readonly" ></textarea>
</div>
<button onclick="list_model()" id="list_model_button">List model</button>
<button onclick="load_model()" id="load_model_button">Load model</button>
<button id="list_axis_model_button">List Axis</button>
<button id="get_total_forces_torques_button">List Forces</button>

<script src="js/aircraft_view.js"></script>
<script>
    document.documentElement.style.overflow='hidden';

    var dis = new DroneDisplayEngine(document.getElementById("container"),
            window.innerWidth, window.innerHeight);
    DroneDisplayEngine.animate(dis);
//        log("Load wing from uiuc");
//        dis.addObject(mesh);
//    });
    var log = function (msg) {
        var d = new Date();
        var new_msg = `[${d.toLocaleTimeString()}] ${msg}`;
        var textarea = $("#log_plant");
        textarea.text(textarea.text() + new_msg + "\n");
        textarea.scrollTop(textarea[0].scrollHeight);
    };
    var con = new ConfigurerDriver(load_model);
    function list_model() {
        con.list_model(function (data) {
            log(`model list ${JSON.stringify(data)}`);
        });
    }
    var aircraftview = 0;
    function load_model() {
        log("Load model");
        var aircraftview = new AircraftView({
            driver:con,
            dis:dis,
            scale:2,
            name:"sample_aircraft"
        });
    }

    function get_internal_states_list() {
        con.query_state(function (data) {
            log(JSON.stringify(data))
        });
    }

    function get_control_axis_list() {
        con.query_control_axis(function (data) {
            log(JSON.stringify(data))
        });
    }

    function get_total_forces_torques() {
        con.get_total_forces_torques(function (data) {
            log(JSON.stringify(data));
            var engine_force = new THREE.Vector3(
                    data.total_engine_force[0],
                    data.total_engine_force[1],
                    data.total_engine_force[2]
            );

            var dir = engine_force.clone();
            dir.normalize();
            var origin = new THREE.Vector3( 0, 0, 0 );
            var length = engine_force.length() / mass / 9.8 * 2;
            var hex = 0xff0000;

            var arrowHelper = new THREE.ArrowHelper( dir, origin, length, hex );
            dis.addObject(arrowHelper);

        });
    }
    
    function set_value_test() {
        con.set_control_axis_value("main_engine_0/thrust",0.5,function (data) {
            log(`set control value ${JSON.stringify(data)}`);
            get_total_forces_torques();
        });
        con.set_internal_state_value("main_engine_0/n",100,function (data) {
            log(`set internal value ${JSON.stringify(data)}`);
            get_total_forces_torques();
        });
    }
</script>
</body>
</html>